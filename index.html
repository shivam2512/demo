<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Practice Session Notes + Assignments (CodeMirror)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    pre { white-space: pre-wrap; word-wrap: break-word; font-family: monospace; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 10px; }
    .weekday { font-weight: 600; text-align: center; color: #495057; padding: 6px 0; background: #f8f9fa; border-radius: 0.5rem; border: 1px solid #e9ecef; }
    .calendar-day { border: 1px solid #dee2e6; padding: 12px; text-align: center; cursor: pointer; min-height: 70px; display: flex; align-items: center; justify-content: center; border-radius: 0.6rem; background-color: #ffffff; transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease; font-weight: 500; }
    .calendar-day.has-notes { background: linear-gradient(135deg, #d1e7dd, #b6e0c2); color: #0f5132; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25); border-color: #b6e0c2; }
    .calendar-day.today { background: linear-gradient(135deg, #fff3cd, #ffe69c); color: #664d03; border-color: #ffe69c; box-shadow: 0 3px 10px rgba(255, 193, 7, 0.25); font-weight: 700; }
    .calendar-day:hover { transform: translateY(-2px); background: linear-gradient(135deg, #f8d7da, #f5c2c7); color: #842029; box-shadow: 0 6px 16px rgba(220, 53, 69, 0.25); border-color: #f5c2c7; }
    #calendarContainer .card { border: none; overflow: hidden; }
    @media (max-width: 576px) {
      .calendar { grid-template-columns: repeat(3, 1fr); }
      .weekday { font-size: 0.8rem; padding: 4px 0; }
      .calendar-day { min-height: 52px; font-size: 0.9rem; padding: 8px; }
      .btn { width: 100%; }
      .nav-controls h4 { font-size: 1rem; margin: 0 8px; }
    }

    #assignmentSection { margin: 32px 0; }
    .new-dot { display: inline-block; width: 10px; height: 10px; background: red; border-radius: 50%; margin-left: 6px; animation: pulse 1s infinite; }
    @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.3; } 100% { transform: scale(1); opacity: 1; } }

    .motivation-bar { overflow: hidden; width: 100%; background: linear-gradient(270deg, #0d6efd, #6610f2, #198754, #20c997); background-size: 600% 600%; animation: gradientMove 10s ease infinite; padding: 10px 0; }
    .motivation-text { display: inline-block; white-space: nowrap; color: #ffffff; font-weight: 600; font-size: 1rem; padding-left: 100%; animation: scrollText 18s linear infinite; }
    @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    @keyframes scrollText { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    #assignmentSection, #openAssignmentsBtn { display: none !important; }
    
    /* Exam Sticky Header */
    .exam-header { position: sticky; top: 0; background: white; z-index: 1000; border-bottom: 2px solid #eee; padding: 10px 0; }
  </style>
</head>
<body>

<div id="uploadNotification" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index:1050;"></div>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container d-flex align-items-center">
      <span class="navbar-brand">Practice Session Notes</span>
      <button class="btn btn-danger ms-3" onclick="initExam()">SQL Assessment (MCQ + Scenario based)</button>
      <div class="ms-auto d-flex gap-2 align-items-center">
        <span id="onlineUsers" class="navbar-text text-info fw-semibold"></span>
      </div>
    </div>
  </nav>

  <div class="motivation-bar">
    <div class="motivation-text">üåüüöÄ Work hard in silence today, so your offer letter speaks loudly tomorrow. üíºüî•</div>
  </div>

  <div id="latestNotification" class="alert alert-info text-center mb-0">Latest notes: Loading‚Ä¶</div>
  <br>
  <center>
    <div class="mb-3">
      <label class="fw-bold">Select Batch:</label>
      <select id="batchSelect" class="form-select d-inline-block w-auto ms-2">
        <option value="JAN_22_2026">Batch ‚Äì Jan 2026</option>
        <option value="DEC_2025">Batch ‚Äì Dec 2025</option>
      </select>
    </div>
  </center>

  <main class="container py-4">
    <center>
      <div class="mb-3 d-flex gap-2 flex-wrap">
        <button class="btn btn-success" onclick="downloadSQLFile('Afternoon','Afternoon.sql')">Download SQL Afternoon Notes</button>
        <button class="btn btn-primary" onclick="downloadSQLFile('Evening','Evening.sql')">Download SQL Evening Notes</button>
        <button class="btn btn-warning" onclick="downloadLinuxPDF('Afternoon','Linux_Afternoon.pdf')">Download Linux Afternoon Notes</button>
        <button class="btn btn-danger" onclick="downloadLinuxPDF('Evening','Linux_Evening.pdf')">Download Linux Evening Notes</button>
      </div>
    </center>

    <div class="nav-controls d-flex justify-content-between align-items-center mb-2">
      <button class="btn btn-outline-secondary" onclick="prevMonth()">‚Üê Previous</button>
      <h4 id="monthLabel" class="fw-bold mb-0"></h4>
      <button class="btn btn-outline-secondary" onclick="nextMonth()">Next ‚Üí</button>
    </div>

    <div id="calendarContainer" class="mb-4"></div>
    <div id="notesContainer"></div>
    <div id="emptyState" class="text-center text-muted py-5 d-none"><h5>No notes yet</h5></div>
    <div class="text-center mt-3">
      <button class="btn btn-outline-secondary d-none" id="clearViewBtn" onclick="clearNotesView()">Clear View</button>
    </div>

    <hr class="my-4">

    <section id="examSection" class="d-none mt-5">
      
      <div id="instructionCard" class="card shadow-lg border-0 mb-4">
        <div class="card-header bg-dark text-white p-3">
          <h4 class="mb-0">Exam Instructions & Rules</h4>
        </div>
        <div class="card-body p-4">
          <div class="alert alert-warning fw-bold">
            ‚ö†Ô∏è Fullscreen mode will be activated. Do not switch tabs or exit fullscreen.
          </div>
          <ul class="list-group list-group-flush mb-4">
            <li class="list-group-item">‚è± <b>Total Time:</b> 30 Minutes</li>
            <li class="list-group-item">üìù <b>Section A:</b> 40 MCQs (1 mark each)</li>
            <li class="list-group-item">üíª <b>Section B:</b> 5 SQL Queries (4 marks each)</li>
            <li class="list-group-item">üö´ <b>Strict Policy:</b> Auto-submit on tab switch or minimizing.</li>
          </ul>
          <button class="btn btn-primary btn-lg w-100 py-3 shadow" onclick="launchFullscreenExam()">
            I UNDERSTAND - START EXAM NOW
          </button>
        </div>
      </div>

      <div id="actualExamForm" style="display:none;">
        <div class="card p-4">
          <div class="exam-header d-flex justify-content-between align-items-center">
            <h4>SQL Assessment</h4>
            <h5 class="text-danger fw-bold">‚è≥ Time Left: <span id="timerDisplay">20:00</span></h5>
          </div>

          <hr>

          <form id="examForm">
            <h4>SQL: Section A: Multiple Choice Questions (40 Marks)</h4>
            <hr>
            <div class="mb-3"><p><b>Q1. Which data type stores fixed-length character data?</b></p>
              <input type="radio" name="q1" value="A"> VARCHAR2<br><input type="radio" name="q1" value="B"> CHAR<br><input type="radio" name="q1" value="C"> NUMBER<br><input type="radio" name="q1" value="D"> DATE</div>
            <div class="mb-3"><p><b>Q2. Maximum size of VARCHAR2 in Oracle is?</b></p>
              <input type="radio" name="q2" value="A"> 2000 bytes<br><input type="radio" name="q2" value="B"> 4000 bytes<br><input type="radio" name="q2" value="C"> 2 GB<br><input type="radio" name="q2" value="D"> 1000 bytes</div>
            <div class="mb-3"><p><b>Q3. Which data type supports multilingual data?</b></p>
              <input type="radio" name="q3" value="A"> CHAR<br><input type="radio" name="q3" value="B"> NCHAR<br><input type="radio" name="q3" value="C"> LONG<br><input type="radio" name="q3" value="D"> DATE</div>
            <div class="mb-3"><p><b>Q4. Maximum precision supported by NUMBER is?</b></p>
              <input type="radio" name="q4" value="A"> 20<br><input type="radio" name="q4" value="B"> 30<br><input type="radio" name="q4" value="C"> 38<br><input type="radio" name="q4" value="D"> 50</div>
            <div class="mb-3"><p><b>Q5. NUMBER(4,2) can store:</b></p>
              <input type="radio" name="q5" value="A"> 9999<br><input type="radio" name="q5" value="B"> 99.20<br><input type="radio" name="q5" value="C"> 1234.567<br><input type="radio" name="q5" value="D"> 999.999</div>
            <div class="mb-3"><p><b>Q6. Which data type is used to store images?</b></p>
              <input type="radio" name="q6" value="A"> CLOB<br><input type="radio" name="q6" value="B"> BLOB<br><input type="radio" name="q6" value="C"> CHAR<br><input type="radio" name="q6" value="D"> NUMBER</div>
            <div class="mb-3"><p><b>Q7. Which command is DDL?</b></p>
              <input type="radio" name="q7" value="A"> INSERT<br><input type="radio" name="q7" value="B"> CREATE<br><input type="radio" name="q7" value="C"> UPDATE<br><input type="radio" name="q7" value="D"> SELECT</div>
            <div class="mb-3"><p><b>Q8. Which command is DML?</b></p>
              <input type="radio" name="q8" value="A"> GRANT<br><input type="radio" name="q8" value="B"> INSERT<br><input type="radio" name="q8" value="C"> ALTER<br><input type="radio" name="q8" value="D"> COMMIT</div>
            <div class="mb-3"><p><b>Q9. WHERE clause is used to:</b></p>
              <input type="radio" name="q9" value="A"> Sort records<br><input type="radio" name="q9" value="B"> Filter records<br><input type="radio" name="q9" value="C"> Group records<br><input type="radio" name="q9" value="D"> Remove duplicates</div>
            <div class="mb-3"><p><b>Q10. DISTINCT is used to:</b></p>
              <input type="radio" name="q10" value="A"> Remove duplicates<br><input type="radio" name="q10" value="B"> Sort records<br><input type="radio" name="q10" value="C"> Join tables<br><input type="radio" name="q10" value="D"> Filter records</div>
            <div class="mb-3"><p><b>Q11. PRIMARY KEY enforces:</b></p>
              <input type="radio" name="q11" value="A"> Only unique<br><input type="radio" name="q11" value="B"> Only not null<br><input type="radio" name="q11" value="C"> Unique and Not Null<br><input type="radio" name="q11" value="D"> Default values</div>
            <div class="mb-3"><p><b>Q12. FOREIGN KEY is used to:</b></p>
              <input type="radio" name="q12" value="A"> Identify table<br><input type="radio" name="q12" value="B"> Link two tables<br><input type="radio" name="q12" value="C"> Delete rows<br><input type="radio" name="q12" value="D"> Sort records</div>
            <div class="mb-3"><p><b>Q13. LEFT JOIN returns:</b></p>
              <input type="radio" name="q13" value="A"> Matching rows only<br><input type="radio" name="q13" value="B"> All left table rows<br><input type="radio" name="q13" value="C"> All right table rows<br><input type="radio" name="q13" value="D"> No rows</div>
            <div class="mb-3"><p><b>Q14. RIGHT JOIN returns:</b></p>
              <input type="radio" name="q14" value="A"> All right table rows<br><input type="radio" name="q14" value="B"> All left rows<br><input type="radio" name="q14" value="C"> Matching only<br><input type="radio" name="q14" value="D"> Cartesian product</div>
            <div class="mb-3"><p><b>Q15. FULL JOIN returns:</b></p>
              <input type="radio" name="q15" value="A"> Matching only<br><input type="radio" name="q15" value="B"> Left only<br><input type="radio" name="q15" value="C"> All records from both tables<br><input type="radio" name="q15" value="D"> Right only</div>
            <div class="mb-3"><p><b>Q16. CROSS JOIN produces:</b></p>
              <input type="radio" name="q16" value="A"> Matching rows<br><input type="radio" name="q16" value="B"> Cartesian product<br><input type="radio" name="q16" value="C"> Grouped rows<br><input type="radio" name="q16" value="D"> Filtered rows</div>
            <div class="mb-3"><p><b>Q17. A subquery is:</b></p>
              <input type="radio" name="q17" value="A"> Query inside query<br><input type="radio" name="q17" value="B"> Join condition<br><input type="radio" name="q17" value="C"> Constraint<br><input type="radio" name="q17" value="D"> Operator</div>
            <div class="mb-3"><p><b>Q18. GROUP BY is used with:</b></p>
              <input type="radio" name="q18" value="A"> WHERE<br><input type="radio" name="q18" value="B"> Aggregate functions<br><input type="radio" name="q18" value="C"> ORDER BY<br><input type="radio" name="q18" value="D"> JOIN</div>
            <div class="mb-3"><p><b>Q19. HAVING clause filters:</b></p>
              <input type="radio" name="q19" value="A"> Rows<br><input type="radio" name="q19" value="B"> Groups<br><input type="radio" name="q19" value="C"> Tables<br><input type="radio" name="q19" value="D"> Columns</div>
            <div class="mb-3"><p><b>Q20. RANK() function gives:</b></p>
              <input type="radio" name="q20" value="A"> Rank without gaps<br><input type="radio" name="q20" value="B"> Rank with gaps<br><input type="radio" name="q20" value="C"> Row number only<br><input type="radio" name="q20" value="D"> Count value</div>
            <div class="mb-3"><p><b>Q21. DENSE_RANK() gives:</b></p>
              <input type="radio" name="q21" value="A"> Rank with gaps<br><input type="radio" name="q21" value="B"> Rank without gaps<br><input type="radio" name="q21" value="C"> Duplicate ranks<br><input type="radio" name="q21" value="D"> Count</div>
            <div class="mb-3"><p><b>Q22. ROW_NUMBER() gives:</b></p>
              <input type="radio" name="q22" value="A"> Sequential unique numbers<br><input type="radio" name="q22" value="B"> Same rank<br><input type="radio" name="q22" value="C"> Gaps<br><input type="radio" name="q22" value="D"> Count</div>
            <div class="mb-3"><p><b>Q23. ROWNUM is:</b></p>
              <input type="radio" name="q23" value="A"> Function<br><input type="radio" name="q23" value="B"> Pseudo column<br><input type="radio" name="q23" value="C"> Constraint<br><input type="radio" name="q23" value="D"> Operator</div>
            <div class="mb-3"><p><b>Q24. CHECK constraint is used to:</b></p>
              <input type="radio" name="q24" value="A"> Restrict values<br><input type="radio" name="q24" value="B"> Create table<br><input type="radio" name="q24" value="C"> Delete table<br><input type="radio" name="q24" value="D"> Sort data</div>
            <div class="mb-3"><p><b>Q25. DEFAULT constraint is used to:</b></p>
              <input type="radio" name="q25" value="A"> Set automatic value<br><input type="radio" name="q25" value="B"> Remove null<br><input type="radio" name="q25" value="C"> Join table<br><input type="radio" name="q25" value="D"> Sort data</div>
            <div class="mb-3"><p><b>Q26. UNIQUE constraint allows:</b></p>
              <input type="radio" name="q26" value="A"> Duplicate values<br><input type="radio" name="q26" value="B"> Unique values<br><input type="radio" name="q26" value="C"> Null only<br><input type="radio" name="q26" value="D"> Default only</div>
            <div class="mb-3"><p><b>Q27. ORDER BY DESC means:</b></p>
              <input type="radio" name="q27" value="A"> Ascending<br><input type="radio" name="q27" value="B"> Descending<br><input type="radio" name="q27" value="C"> Grouping<br><input type="radio" name="q27" value="D"> Filtering</div>
            <div class="mb-3"><p><b>Q28. UPPER() is:</b></p>
              <input type="radio" name="q28" value="A"> Number function<br><input type="radio" name="q28" value="B"> Character function<br><input type="radio" name="q28" value="C"> Date function<br><input type="radio" name="q28" value="D"> Logical function</div>
            <div class="mb-3"><p><b>Q29. ROUND() is:</b></p>
              <input type="radio" name="q29" value="A"> Character function<br><input type="radio" name="q29" value="B"> Number function<br><input type="radio" name="q29" value="C"> Date function<br><input type="radio" name="q29" value="D"> Logical function</div>
            <div class="mb-3"><p><b>Q30. SYSDATE returns:</b></p>
              <input type="radio" name="q30" value="A"> Current number<br><input type="radio" name="q30" value="B"> Current date<br><input type="radio" name="q30" value="C"> Current string<br><input type="radio" name="q30" value="D"> Null</div>
            <div class="mb-3"><p><b>Q31. TO_CHAR() is:</b></p>
              <input type="radio" name="q31" value="A"> Conversion function<br><input type="radio" name="q31" value="B"> Date function<br><input type="radio" name="q31" value="C"> Join function<br><input type="radio" name="q31" value="D"> Logical function</div>
            <div class="mb-3"><p><b>Q32. CASE expression is used for:</b></p>
              <input type="radio" name="q32" value="A"> Looping<br><input type="radio" name="q32" value="B"> Conditional logic<br><input type="radio" name="q32" value="C"> Sorting<br><input type="radio" name="q32" value="D"> Joining</div>
            <div class="mb-3"><p><b>Q33. COMMIT is:</b></p>
              <input type="radio" name="q33" value="A"> DML<br><input type="radio" name="q33" value="B"> TCL<br><input type="radio" name="q33" value="C"> DDL<br><input type="radio" name="q33" value="D"> DCL</div>
            <div class="mb-3"><p><b>Q34. GRANT belongs to:</b></p>
              <input type="radio" name="q34" value="A"> DDL<br><input type="radio" name="q34" value="B"> DML<br><input type="radio" name="q34" value="C"> DCL<br><input type="radio" name="q34" value="D"> TCL</div>
            <div class="mb-3"><p><b>Q35. Arithmetic operator example:</b></p>
              <input type="radio" name="q35" value="A"> AND<br><input type="radio" name="q35" value="B"> +<br><input type="radio" name="q35" value="C"> LIKE<br><input type="radio" name="q35" value="D"> IN</div>
            <div class="mb-3"><p><b>Q36. Relational operator example:</b></p>
              <input type="radio" name="q36" value="A"> ><br><input type="radio" name="q36" value="B"> +<br><input type="radio" name="q36" value="C"> ||<br><input type="radio" name="q36" value="D"> AND</div>
            <div class="mb-3"><p><b>Q37. Logical operator example:</b></p>
              <input type="radio" name="q37" value="A"> OR<br><input type="radio" name="q37" value="B"> +<br><input type="radio" name="q37" value="C"> =<br><input type="radio" name="q37" value="D"> *</div>
            <div class="mb-3"><p><b>Q38. Which LOB stores large text data?</b></p>
              <input type="radio" name="q38" value="A"> BLOB<br><input type="radio" name="q38" value="B"> CLOB<br><input type="radio" name="q38" value="C"> RAW<br><input type="radio" name="q38" value="D"> LONG</div>
            <div class="mb-3"><p><b>Q39. Only one LONG column is allowed per:</b></p>
              <input type="radio" name="q39" value="A"> Database<br><input type="radio" name="q39" value="B"> Table<br><input type="radio" name="q39" value="C"> Schema<br><input type="radio" name="q39" value="D"> View</div>
            <div class="mb-3"><p><b>Q40. HAVING is used with:</b></p>
              <input type="radio" name="q40" value="A"> GROUP BY<br><input type="radio" name="q40" value="B"> WHERE<br><input type="radio" name="q40" value="C"> ORDER BY<br><input type="radio" name="q40" value="D"> JOIN</div>

            <h4>Section B: SQL Query Writing (20 Marks)</h4>
            <hr>
            <div class="mb-4"><p><b>Q41.</b> STUDENTS(student_id, name, course_id) and COURSES(course_id, course_name). Write a query to display student name and course name using INNER JOIN.</p>
              <textarea name="q41" class="form-control" rows="4" required></textarea></div>
            <div class="mb-4"><p><b>Q42.</b> Write a query to display all students even if they are not enrolled in any course.</p>
              <textarea name="q42" class="form-control" rows="4" required></textarea></div>
            <div class="mb-4"><p><b>Q43.</b> EMP(emp_id, name, salary). Write a subquery to find employees earning more than average salary.</p>
              <textarea name="q43" class="form-control" rows="4" required></textarea></div>
            <div class="mb-4"><p><b>Q44.</b> Write a query using subquery to find second highest salary.</p>
              <textarea name="q44" class="form-control" rows="4" required></textarea></div>
            <div class="mb-4"><p><b>Q45.</b> DEPT(dept_id, dept_name) and EMP(emp_id, salary, dept_id). Write a query to display department name and total salary using GROUP BY.</p>
              <textarea name="q45" class="form-control" rows="4" required></textarea></div>

            <button type="button" class="btn btn-success w-100 py-3" onclick="submitExam()">Submit Final Exam</button>
          </form>
        </div>
      </div>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    /***********************
     Original notes/calendar 
    ***********************/
    let allNotes = [];
    const CURRENT_BATCH = 'JAN_22_2026';
    let currentMonthIndex, currentYear;
    const monthMap = { JAN: "01", FEB: "02", MAR: "03", APR: "04", MAY: "05", JUN: "06", JUL: "07", AUG: "08", SEP: "09", OCT: "10", NOV: "11", DEC: "12" };
    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

    function parseNoteDate(str){ const [d,mText,y] = str.split("-"); const mNum = Number(monthMap[mText.toUpperCase()]); return { day:d, monthNum:mNum, monthText:mText.toUpperCase(), year:y }; }
    function toJSDate(str){ const {day, monthNum, year} = parseNoteDate(str); return new Date(Number(year), monthNum-1, Number(day)); }

    async function loadNotes(){
      try {
        const res = await fetch("notes.json");
        const notes = await res.json();
        allNotes = notes;
        document.getElementById('batchSelect').value = CURRENT_BATCH;
        const today = new Date();
        currentMonthIndex = today.getMonth();
        currentYear = today.getFullYear();
        renderCalendar();
        updateLatestNotification();
      } catch(err){ console.error("Error loading notes:", err); }
    }

    function renderCalendar(){
      const container = document.getElementById("calendarContainer"); container.innerHTML="";
      document.getElementById("monthLabel").textContent = `${monthNames[currentMonthIndex]} ${currentYear}`;
      const daysInMonth = new Date(currentYear, currentMonthIndex+1, 0).getDate();
      let firstDay = new Date(currentYear, currentMonthIndex,1).getDay(); firstDay = firstDay === 0 ? 7 : firstDay;
      const card = document.createElement("div"); card.className="card shadow-lg";
      const calendarBody = document.createElement("div"); calendarBody.className="card-body";
      const weekdays = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]; const weekdayRow = document.createElement("div"); weekdayRow.className="calendar";
      weekdays.forEach(w=>{ const wd=document.createElement("div"); wd.className="weekday"; wd.textContent=w; weekdayRow.appendChild(wd); });
      calendarBody.appendChild(weekdayRow);
      const calendar = document.createElement("div"); calendar.className="calendar";
      for(let i=1;i<firstDay;i++){ const emptyCell=document.createElement("div"); emptyCell.className="calendar-day"; calendar.appendChild(emptyCell); }
      const today = new Date();
      for(let d=1; d<=daysInMonth; d++){
        const dayStr=String(d).padStart(2,'0');
        const hasNote = allNotes.some(n => { if (n.batch !== getSelectedBatch()) return false; const { day, monthNum, year } = parseNoteDate(n.date); return (day === dayStr && monthNum === currentMonthIndex + 1 && Number(year) === currentYear); });
        const dayCell = document.createElement("div"); dayCell.className = "calendar-day" + (hasNote ? " has-notes": ""); dayCell.textContent = d;
        if(today.getMonth()===currentMonthIndex && today.getFullYear()===currentYear && today.getDate()===d) dayCell.classList.add("today");
        dayCell.addEventListener("click", () => { const filtered = allNotes.filter(n => { if (n.batch !== getSelectedBatch()) return false; const { day, monthNum, year } = parseNoteDate(n.date); return (day === dayStr && monthNum === currentMonthIndex + 1 && Number(year) === currentYear); }); renderNotes(filtered); });
        calendar.appendChild(dayCell);
      }
      calendarBody.appendChild(calendar); card.appendChild(calendarBody); container.appendChild(card);
    }

    function prevMonth(){ currentMonthIndex--; if(currentMonthIndex<0){ currentMonthIndex=11; currentYear--; } renderCalendar(); }
    function nextMonth(){ currentMonthIndex++; if(currentMonthIndex>11){ currentMonthIndex=0; currentYear++; } renderCalendar(); }
    function renderNotes(notes){
      const container = document.getElementById("notesContainer"); container.innerHTML="";
      if(!notes.length) return;
      notes.forEach(n=>{ const card=document.createElement("div"); card.className="card mb-3 shadow-sm"; card.innerHTML = `<div class="card-header bg-success text-white"><strong>${n.date}</strong> ‚Äì ${n.session}</div><div class="card-body"><pre class="bg-light p-3 rounded"><code>${n.body}</code></pre></div>`; container.appendChild(card); });
    }
    function clearNotesView(){ document.getElementById("notesContainer").innerHTML=""; }
    function downloadSQLFile(session, filename) {
      const sessionNotes = allNotes.filter(n => n.session === session && n.subject === "SQL" && n.batch === getSelectedBatch());
      const sqlContent = sessionNotes.map(n => `-- ${n.date}\n${n.body}\n\n`).join("");
      const blob = new Blob([sqlContent], { type: "text/sql" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a"); a.href = url; a.download = filename; a.click();
    }
    function downloadLinuxPDF(session, filename) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const notes = allNotes.filter(n => n.session === session && n.subject === "LINUX" && n.batch === getSelectedBatch());
      let y = 10;
      notes.forEach(n => { doc.text(`${n.date}`, 10, y); y += 10; doc.text(doc.splitTextToSize(n.body, 180), 10, y); y += 40; });
      doc.save(filename);
    }
    function updateLatestNotification(){ if(!allNotes.length) return; const sorted=[...allNotes].sort((a,b)=> toJSDate(b.date)-toJSDate(a.date)); document.getElementById("latestNotification").textContent = `üîî Latest notes: ${sorted[0].date}`; }
    loadNotes();
    function getSelectedBatch() { return document.getElementById('batchSelect').value; }
    document.getElementById('batchSelect').addEventListener('change', () => { renderCalendar(); clearNotesView(); });
  </script>

  <script>
    window.API = 'https://script.google.com/macros/s/AKfycbxAZb0HF920Ye-IXjVZCJumioWX3kzt3PWdVzTO1vSSEV0u-gNZtBSksIIUPlmNS1zmnQ/exec';
    
    let examStarted = false;
    let examSubmitted = false;
    let examDuration = 20 * 60; // 30 minutes
    let timerInterval;

    async function initExam() {
      const name = prompt("Enter Your Full Name");
      if (!name || name.trim().length < 3) return;
      const mobile = prompt("Enter 10 Digit Mobile Number");
      const cleanMobile = mobile ? mobile.replace(/\D/g, '') : '';
      if (!/^\d{10}$/.test(cleanMobile)) { alert("Invalid Mobile"); return; }
      const email = prompt("Enter Your Email Address");
      if (!email || !email.includes("@")) { alert("Invalid Email"); return; }

      const res = await fetch(API, { method: 'POST', body: JSON.stringify({ action: "checkExamAttempt", mobile: cleanMobile }) });
      const data = await res.json();
      if (!data.allowed) { alert("‚ùå Already attempted."); return; }

      window.studentExam = { name: name.trim(), mobile: cleanMobile, email: email.trim() };
      document.getElementById("examSection").classList.remove("d-none");
      document.getElementById("instructionCard").classList.remove("d-none");
      document.getElementById("actualExamForm").style.display = "none";
      document.getElementById("examSection").scrollIntoView({behavior: 'smooth'});
    }

    function launchFullscreenExam() {
      const elem = document.documentElement;
      if (elem.requestFullscreen) { elem.requestFullscreen(); } 
      else if (elem.webkitRequestFullscreen) { elem.webkitRequestFullscreen(); }

      document.getElementById("instructionCard").classList.add("d-none");
      document.getElementById("actualExamForm").style.display = "block";
      startExam();
    }

    function startExam() {
      examStarted = true;
      startTimer();
    }

    function startTimer() {
      const timerDisplay = document.getElementById("timerDisplay");
      timerInterval = setInterval(() => {
        let min = Math.floor(examDuration / 60);
        let sec = examDuration % 60;
        timerDisplay.innerText = `${min}:${sec < 10 ? '0' : ''}${sec}`;
        if (examDuration <= 0) { clearInterval(timerInterval); submitExam(); }
        examDuration--;
      }, 1000);
    }

    async function submitExam() {
      if (examSubmitted) return;
      const submitBtn = document.querySelector('#examForm button');
      submitBtn.disabled = true;
      submitBtn.innerText = "Submitting...";

      try {
        const form = document.getElementById('examForm');
        const payload = {
          action: "secureExamSubmit",
          name: window.studentExam.name,
          mobile: window.studentExam.mobile,
          email: window.studentExam.email,
          answers: {},
        };

        for (let i = 1; i <= 40; i++) {
          const q = form.querySelector(`input[name="q${i}"]:checked`);
          payload.answers[`q${i}`] = q ? q.value : null;
        }
        for (let i = 41; i <= 45; i++) {
          const q = form.querySelector(`textarea[name="q${i}"]`);
          payload[`q${i}`] = q ? q.value.trim() : '';
        }

        const response = await fetch(API, { method: "POST", body: JSON.stringify(payload) });
        const result = await response.json();

        if (result.status === "success") {
          examSubmitted = true;
          clearInterval(timerInterval);
          if (document.fullscreenElement) document.exitFullscreen();
          alert("‚úÖ Exam submitted successfully!");
          document.getElementById("examSection").innerHTML = `<div class="alert alert-success"><h3>Submitted!</h3></div>`;
        }
      } catch (err) { alert("Error submitting exam."); submitBtn.disabled = false; }
    }

    // Fullscreen exit security
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement && examStarted && !examSubmitted) {
        alert("Security Violation: You exited fullscreen. Auto-submitting.");
        submitExam();
      }
    });

    // Tab switch security
    document.addEventListener("visibilitychange", () => {
      if (examStarted && !examSubmitted && document.hidden) { submitExam(); }
    });

    // Right click disable
    document.addEventListener('contextmenu', e => e.preventDefault());
  </script>
</body>
</html>